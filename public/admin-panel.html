<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ACE — Works Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=DM+Mono:wght@300;400&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg: #f8f7f5;
      --surface: #ffffff;
      --surface2: #f2f1ef;
      --border: rgba(0,0,0,0.07);
      --border-strong: rgba(0,0,0,0.12);
      --text: #1a1a1a;
      --text-muted: rgba(26,26,26,0.45);
      --text-subtle: rgba(26,26,26,0.28);
      --accent: #1a1a1a;
      --accent-fg: #ffffff;
      --brand: #ffffff;
      --tag-bg: #f0efed;
      --tag-text: #4a4a4a;
      --shadow: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
      --shadow-md: 0 4px 16px rgba(0,0,0,0.07), 0 1px 4px rgba(0,0,0,0.04);
      --red: #f87171;
      --green: #6ee7b7;
      --yellow: #fcd34d;
      --blue: #93c5fd;
      --radius: 16px;
      --radius-sm: 10px;
      --radius-xs: 7px;
    }

    [data-theme="dark"] {
      --bg: #111110;
      --surface: #1c1c1b;
      --surface2: #252524;
      --border: rgba(255,255,255,0.07);
      --border-strong: rgba(255,255,255,0.12);
      --text: #f0ede8;
      --text-muted: rgba(240,237,232,0.45);
      --text-subtle: rgba(240,237,232,0.28);
      --accent: #f0ede8;
      --accent-fg: #111110;
      --brand: #ffffff;
      --tag-bg: #2a2a29;
      --tag-text: #c8c5bf;
      --shadow: 0 1px 3px rgba(0,0,0,0.3), 0 1px 2px rgba(0,0,0,0.2);
      --shadow-md: 0 4px 16px rgba(0,0,0,0.4), 0 1px 4px rgba(0,0,0,0.2);
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      font-size: 14px;
      line-height: 1.5;
      transition: background 0.2s, color 0.2s;
    }

    /* ── Layout ─────────────────────────────── */
    .app { display: flex; min-height: 100vh; }

    .sidebar {
      width: 220px;
      flex-shrink: 0;
      background: var(--surface);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      padding: 20px 14px;
      gap: 6px;
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px 18px;
      font-weight: 600;
      font-size: 15px;
      letter-spacing: -0.3px;
      color: var(--text);
    }

    .sidebar-logo .dot {
      width: 20px; height: 20px;
      background: var(--accent);
      border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
    }

    .sidebar-logo .dot svg { width: 11px; height: 11px; fill: var(--accent-fg); }

    .nav-item {
      display: flex; align-items: center; gap: 9px;
      padding: 8px 10px;
      border-radius: var(--radius-xs);
      cursor: pointer;
      color: var(--text-muted);
      font-size: 13.5px;
      font-weight: 400;
      transition: all 0.15s;
      border: none; background: none; width: 100%; text-align: left;
    }
    .nav-item svg { width: 16px; height: 16px; flex-shrink: 0; opacity: 0.7; }
    .nav-item:hover { background: var(--surface2); color: var(--text); }
    .nav-item.active { background: var(--surface2); color: var(--text); font-weight: 500; }
    .nav-item.active svg { opacity: 1; }

    .sidebar-section {
      font-size: 10.5px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--text-subtle);
      padding: 14px 10px 4px;
    }

    .sidebar-bottom {
      margin-top: auto;
      padding-top: 14px;
      border-top: 1px solid var(--border);
      display: flex; flex-direction: column; gap: 4px;
    }

    .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }

    .topbar {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 14px 28px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .topbar-left { display: flex; align-items: center; gap: 10px; }

    .page-title { font-size: 15px; font-weight: 500; color: var(--text); letter-spacing: -0.2px; }

    .topbar-right { display: flex; align-items: center; gap: 10px; }

    .btn {
      display: inline-flex; align-items: center; gap: 7px;
      padding: 8px 14px;
      border-radius: var(--radius-xs);
      font-size: 13px; font-weight: 500;
      cursor: pointer; border: none;
      font-family: 'DM Sans', sans-serif;
      transition: all 0.15s;
    }
    .btn svg { width: 14px; height: 14px; }

    .btn-primary {
      background: var(--accent);
      color: var(--accent-fg);
    }
    .btn-primary:hover { opacity: 0.88; }

    .btn-ghost {
      background: transparent;
      color: var(--text-muted);
      border: 1px solid var(--border-strong);
    }
    .btn-ghost:hover { background: var(--surface2); color: var(--text); }

    .icon-btn {
      width: 34px; height: 34px;
      display: flex; align-items: center; justify-content: center;
      border-radius: var(--radius-xs);
      cursor: pointer; border: 1px solid var(--border-strong);
      background: transparent; color: var(--text-muted);
      transition: all 0.15s;
    }
    .icon-btn:hover { background: var(--surface2); color: var(--text); }
    .icon-btn svg { width: 16px; height: 16px; }

    /* ── Content Area ─────────────────────────────── */
    .content {
      display: grid;
      grid-template-columns: 1fr 360px;
      height: calc(100vh - 57px);
      overflow: hidden;
    }

    .works-list-panel {
      overflow-y: auto;
      padding: 24px 28px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .panel-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 4px;
    }

    .panel-title {
      font-size: 12px; font-weight: 500;
      letter-spacing: 0.06em; text-transform: uppercase;
      color: var(--text-subtle);
    }

    .count-badge {
      font-size: 11px; font-weight: 500;
      background: var(--surface2);
      color: var(--text-muted);
      padding: 2px 8px;
      border-radius: 20px;
    }

    /* ── Work Cards in List ─────────────────────────────── */
    .work-item {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 14px 16px;
      cursor: pointer;
      transition: all 0.15s;
      display: flex; align-items: center; gap: 14px;
    }
    .work-item:hover { border-color: var(--border-strong); box-shadow: var(--shadow-md); }
    .work-item.selected { border-color: var(--accent); box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 12%, transparent); }

    .work-thumb {
      width: 56px; height: 44px;
      border-radius: 8px;
      background: var(--surface2);
      flex-shrink: 0;
      overflow: hidden;
      display: flex; align-items: center; justify-content: center;
      color: var(--text-subtle);
    }
    .work-thumb img { width: 100%; height: 100%; object-fit: cover; }
    .work-thumb svg { width: 20px; height: 20px; }

    .work-info { flex: 1; min-width: 0; }
    .work-name { font-size: 13.5px; font-weight: 500; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .work-meta { font-size: 12px; color: var(--text-muted); margin-top: 2px; display: flex; align-items: center; gap: 6px; }

    .work-type-badge {
      font-size: 10px; font-weight: 500;
      padding: 2px 7px;
      border-radius: 20px;
      letter-spacing: 0.03em;
    }
    .badge-single { background: #e8f4ff; color: #4a90d9; }
    .badge-double { background: #f0f0ff; color: #7c7cd4; }
    [data-theme="dark"] .badge-single { background: rgba(74,144,217,0.15); }
    [data-theme="dark"] .badge-double { background: rgba(124,124,212,0.15); }

    .work-actions {
      display: flex; gap: 6px;
      opacity: 0;
      transition: opacity 0.15s;
    }
    .work-item:hover .work-actions { opacity: 1; }

    /* ── Preview / Edit Panel ─────────────────────────────── */
    .preview-panel {
      border-left: 1px solid var(--border);
      background: var(--surface);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .preview-empty {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
      color: var(--text-subtle);
      padding: 40px;
      text-align: center;
    }
    .preview-empty svg { width: 40px; height: 40px; opacity: 0.4; }
    .preview-empty p { font-size: 13px; }

    .edit-form {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .edit-header {
      padding: 18px 20px 14px;
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; gap: 12px;
    }

    .edit-header-title {
      font-size: 14px; font-weight: 500; color: var(--text);
      flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }

    .edit-body { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 18px; }

    .form-group { display: flex; flex-direction: column; gap: 6px; }
    .form-label {
      font-size: 11.5px; font-weight: 500;
      letter-spacing: 0.04em; text-transform: uppercase;
      color: var(--text-subtle);
    }

    .form-input, .form-textarea, .form-select {
      width: 100%;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 9px 12px;
      font-size: 13.5px;
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      transition: border-color 0.15s;
      outline: none;
    }
    .form-input:focus, .form-textarea:focus { border-color: var(--border-strong); background: var(--surface); }
    .form-textarea { resize: vertical; min-height: 70px; }

    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

    /* ── Designer Selector ─────────────────────────────── */
    .designer-selector {
      position: relative;
    }

    .designer-trigger {
      width: 100%;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 8px 12px;
      font-size: 13.5px;
      color: var(--text-muted);
      font-family: 'DM Sans', sans-serif;
      cursor: pointer;
      display: flex; align-items: center; justify-content: space-between;
      gap: 8px;
      text-align: left;
      transition: border-color 0.15s;
    }
    .designer-trigger:focus { outline: none; border-color: var(--border-strong); }
    .designer-trigger.open { border-color: var(--border-strong); background: var(--surface); }
    .designer-trigger svg { width: 14px; height: 14px; flex-shrink: 0; transition: transform 0.15s; }
    .designer-trigger.open svg { transform: rotate(180deg); }

    .designer-dropdown {
      position: absolute;
      top: calc(100% + 4px);
      left: 0; right: 0;
      background: var(--surface);
      border: 1px solid var(--border-strong);
      border-radius: var(--radius-sm);
      box-shadow: var(--shadow-md);
      z-index: 200;
      overflow: hidden;
      display: none;
    }
    .designer-dropdown.open { display: block; }

    .designer-option {
      display: flex; align-items: center; gap: 10px;
      padding: 8px 12px;
      cursor: pointer;
      transition: background 0.12s;
    }
    .designer-option:hover { background: var(--surface2); }
    .designer-option.selected { background: color-mix(in srgb, var(--accent) 7%, transparent); }

    .designer-avatar {
      width: 26px; height: 26px;
      border-radius: 50%;
      background: var(--surface2);
      flex-shrink: 0;
      overflow: hidden;
      display: flex; align-items: center; justify-content: center;
      font-size: 10px; font-weight: 600; color: var(--text-muted);
    }
    .designer-avatar img { width: 100%; height: 100%; object-fit: cover; }

    .designer-name { font-size: 13px; color: var(--text); flex: 1; }

    .check-icon {
      width: 16px; height: 16px;
      border-radius: 4px;
      border: 1.5px solid var(--border-strong);
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
      transition: all 0.12s;
    }
    .designer-option.selected .check-icon {
      background: var(--accent);
      border-color: var(--accent);
    }
    .check-icon svg { width: 9px; height: 9px; display: none; }
    .designer-option.selected .check-icon svg { display: block; fill: var(--accent-fg); }

    .selected-designers {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      min-height: 0;
    }

    .designer-tag {
      display: flex; align-items: center; gap: 5px;
      background: var(--tag-bg);
      color: var(--tag-text);
      padding: 3px 8px 3px 5px;
      border-radius: 20px;
      font-size: 12px; font-weight: 400;
    }
    .designer-tag .tag-avatar {
      width: 18px; height: 18px;
      border-radius: 50%;
      background: var(--surface2);
      overflow: hidden;
      flex-shrink: 0;
    }
    .designer-tag .tag-avatar img { width: 100%; height: 100%; object-fit: cover; }
    .designer-tag button {
      background: none; border: none; cursor: pointer;
      color: var(--text-muted); padding: 0;
      width: 14px; height: 14px;
      display: flex; align-items: center; justify-content: center;
      border-radius: 50%;
      transition: all 0.12s;
    }
    .designer-tag button:hover { background: rgba(0,0,0,0.08); color: var(--text); }
    .designer-tag button svg { width: 8px; height: 8px; }

    /* ── Image Upload ─────────────────────────────── */
    .image-upload-area {
      border: 1.5px dashed var(--border-strong);
      border-radius: var(--radius-sm);
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.15s;
      text-align: center;
      background: var(--surface2);
    }
    .image-upload-area:hover { border-color: var(--accent); background: color-mix(in srgb, var(--accent) 4%, var(--surface2)); }
    .image-upload-area svg { width: 24px; height: 24px; color: var(--text-subtle); }
    .image-upload-area p { font-size: 12.5px; color: var(--text-muted); }
    .image-upload-area span { font-size: 11px; color: var(--text-subtle); }

    .image-previews {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
      gap: 8px;
      margin-top: 10px;
    }

    .image-preview-item {
      aspect-ratio: 4/3;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
      background: var(--surface2);
    }
    .image-preview-item img { width: 100%; height: 100%; object-fit: cover; }
    .image-preview-item .remove-img {
      position: absolute; top: 4px; right: 4px;
      width: 20px; height: 20px;
      background: rgba(0,0,0,0.6);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; border: none; color: white;
      opacity: 0; transition: opacity 0.15s;
    }
    .image-preview-item:hover .remove-img { opacity: 1; }
    .image-preview-item .remove-img svg { width: 10px; height: 10px; }

    /* ── Toggle ─────────────────────────────── */
    .toggle-row {
      display: flex; align-items: center; justify-content: space-between;
    }
    .toggle-label { font-size: 13.5px; color: var(--text); }
    .toggle-desc { font-size: 12px; color: var(--text-muted); margin-top: 1px; }

    .toggle {
      width: 38px; height: 22px;
      background: var(--surface2);
      border: 1.5px solid var(--border-strong);
      border-radius: 20px;
      position: relative;
      cursor: pointer;
      transition: all 0.2s;
      flex-shrink: 0;
    }
    .toggle::after {
      content: '';
      position: absolute;
      top: 2px; left: 2px;
      width: 14px; height: 14px;
      background: var(--text-muted);
      border-radius: 50%;
      transition: all 0.2s;
    }
    .toggle.on { background: var(--accent); border-color: var(--accent); }
    .toggle.on::after { left: 18px; background: var(--accent-fg); }

    /* ── Edit Footer ─────────────────────────────── */
    .edit-footer {
      padding: 14px 20px;
      border-top: 1px solid var(--border);
      display: flex; gap: 8px;
    }
    .edit-footer .btn { flex: 1; justify-content: center; }

    /* ── Stats bar ─────────────────────────────── */
    .stats-row {
      display: grid; grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 4px;
    }

    .stat-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 14px 16px;
    }
    .stat-value { font-size: 22px; font-weight: 600; letter-spacing: -0.5px; color: var(--text); }
    .stat-label { font-size: 11.5px; color: var(--text-muted); margin-top: 2px; }

    /* ── Notifications / toasts ─────────────────────────────── */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--surface);
      border: 1px solid var(--border-strong);
      border-radius: var(--radius-sm);
      padding: 12px 16px;
      font-size: 13px;
      color: var(--text);
      box-shadow: var(--shadow-md);
      z-index: 9999;
      display: flex; align-items: center; gap: 8px;
      transform: translateY(10px);
      opacity: 0;
      transition: all 0.2s;
    }
    .toast.show { transform: translateY(0); opacity: 1; }
    .toast svg { width: 16px; height: 16px; flex-shrink: 0; }
    .toast.success svg { color: #22c55e; }
    .toast.error svg { color: var(--red); }

    /* ── Confirm dialog ─────────────────────────────── */
    .overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.4);
      z-index: 500;
      display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none;
      transition: opacity 0.15s;
    }
    .overlay.open { opacity: 1; pointer-events: all; }

    .dialog {
      background: var(--surface);
      border: 1px solid var(--border-strong);
      border-radius: var(--radius);
      padding: 24px;
      width: 360px;
      box-shadow: var(--shadow-md);
      transform: scale(0.96);
      transition: transform 0.15s;
    }
    .overlay.open .dialog { transform: scale(1); }
    .dialog h3 { font-size: 15px; font-weight: 600; margin-bottom: 8px; }
    .dialog p { font-size: 13.5px; color: var(--text-muted); margin-bottom: 20px; }
    .dialog-btns { display: flex; gap: 8px; justify-content: flex-end; }

    .btn-danger {
      background: #ef4444; color: white;
    }
    .btn-danger:hover { background: #dc2626; }

    /* ── Mono ─────────────────────────────── */
    code { font-family: 'DM Mono', monospace; font-size: 12px; }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border-strong); border-radius: 99px; }

    /* Tools tag input */
    .tags-input-wrap {
      display: flex; flex-wrap: wrap; gap: 5px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 7px 10px;
      min-height: 40px;
      cursor: text;
      transition: border-color 0.15s;
    }
    .tags-input-wrap:focus-within { border-color: var(--border-strong); background: var(--surface); }
    .tags-input-wrap input {
      border: none; background: none; outline: none;
      font-size: 13.5px; color: var(--text);
      font-family: 'DM Sans', sans-serif;
      min-width: 80px; flex: 1;
    }
    .tool-tag {
      display: inline-flex; align-items: center; gap: 4px;
      background: var(--tag-bg);
      color: var(--tag-text);
      padding: 2px 8px 2px 8px;
      border-radius: 20px;
      font-size: 12px;
    }
    .tool-tag button {
      background: none; border: none; cursor: pointer;
      color: var(--text-muted); padding: 0;
      display: flex; align-items: center;
    }
    .tool-tag button svg { width: 9px; height: 9px; }

    /* Divider */
    .divider { height: 1px; background: var(--border); margin: 4px 0; }

    /* bg color picker */
    .color-swatch-row { display: flex; flex-wrap: wrap; gap: 6px; }
    .color-swatch {
      width: 26px; height: 26px;
      border-radius: 6px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border-color 0.12s;
    }
    .color-swatch.selected { border-color: var(--accent); }
    .color-swatch-custom {
      width: 26px; height: 26px;
      border-radius: 6px;
      border: 1.5px dashed var(--border-strong);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; overflow: hidden;
    }
    .color-swatch-custom input[type="color"] {
      opacity: 0; position: absolute; width: 1px; height: 1px;
    }

    @media (max-width: 900px) {
      .sidebar { display: none; }
      .content { grid-template-columns: 1fr; }
      .preview-panel { display: none; }
    }
  </style>
</head>

<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        <div class="dot">
          <svg viewBox="0 0 12 12"><rect x="1" y="1" width="4" height="4" rx="1"/><rect x="7" y="1" width="4" height="4" rx="1"/><rect x="1" y="7" width="4" height="4" rx="1"/><rect x="7" y="7" width="4" height="4" rx="1"/></svg>
        </div>
        ACE Studio
      </div>

      <span class="sidebar-section">Content</span>
      <button class="nav-item active" onclick="setPage('works')">
        <svg viewBox="0 0 16 16" fill="currentColor"><rect x="1" y="1" width="6" height="6" rx="1.5"/><rect x="9" y="1" width="6" height="6" rx="1.5"/><rect x="1" y="9" width="6" height="6" rx="1.5"/><rect x="9" y="9" width="6" height="6" rx="1.5"/></svg>
        Recent Works
      </button>
      <button class="nav-item" onclick="setPage('members')">
        <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="6" cy="5.5" r="2.5"/><path d="M1 13c0-2.8 2.2-5 5-5s5 2.2 5 5"/><circle cx="12" cy="5.5" r="2"/><path d="M15 13c0-2-1.3-3.7-3-4.3"/></svg>
        Designers
      </button>

      <span class="sidebar-section">System</span>
      <button class="nav-item" onclick="showToast('Coming soon', 'success')">
        <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M8 2v12M2 8h12"/></svg>
        Add Work
      </button>

      <div class="sidebar-bottom">
        <button class="nav-item" id="themeToggle" onclick="toggleTheme()">
          <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" id="themeIcon">
            <circle cx="8" cy="8" r="3"/><path d="M8 1v2M8 13v2M1 8h2M13 8h2M3.5 3.5l1.4 1.4M11.1 11.1l1.4 1.4M11.1 4.9l-1.4 1.4M4.9 11.1l-1.4 1.4"/>
          </svg>
          <span id="themeLabel">Dark Mode</span>
        </button>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <!-- Topbar -->
      <div class="topbar">
        <div class="topbar-left">
          <span class="page-title">Recent Works</span>
        </div>
        <div class="topbar-right">
          <button class="btn btn-ghost" onclick="showToast('Exported to clipboard', 'success')">
            <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M10 2H6a1 1 0 00-1 1v10a1 1 0 001 1h6a1 1 0 001-1V5l-3-3z"/><path d="M10 2v3h3"/></svg>
            Export
          </button>
          <button class="btn btn-primary" onclick="openNewWork()">
            <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M8 2v12M2 8h12"/></svg>
            New Work
          </button>
        </div>
      </div>

      <!-- Content Split -->
      <div class="content">
        <!-- Works List -->
        <div class="works-list-panel" id="worksPanel">
          <!-- Stats -->
          <div class="stats-row" id="statsRow"></div>

          <div class="panel-header">
            <span class="panel-title">All Works</span>
            <span class="count-badge" id="workCount">0 items</span>
          </div>

          <div id="worksList"></div>
        </div>

        <!-- Preview / Edit Panel -->
        <div class="preview-panel" id="previewPanel">
          <div class="preview-empty" id="previewEmpty">
            <svg viewBox="0 0 40 40" fill="none" stroke="currentColor" stroke-width="1.2">
              <rect x="5" y="8" width="30" height="24" rx="3"/>
              <path d="M14 20h12M14 25h8"/>
            </svg>
            <p>Select a work to edit<br>or create a new one</p>
          </div>
          <div class="edit-form" id="editForm" style="display:none">
            <div class="edit-header">
              <button class="icon-btn" onclick="closeEdit()" title="Close">
                <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 3l10 10M13 3L3 13"/></svg>
              </button>
              <span class="edit-header-title" id="editFormTitle">New Work</span>
              <span class="work-type-badge" id="editTypeBadge">Single</span>
            </div>

            <div class="edit-body">
              <!-- Basic Info -->
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Project Title</label>
                  <input class="form-input" id="f_title" placeholder="e.g. JET Product" type="text" />
                </div>
                <div class="form-group">
                  <label class="form-label">Client</label>
                  <input class="form-input" id="f_client" placeholder="e.g. FTX Exchange" type="text" />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Date</label>
                  <input class="form-input" id="f_date" placeholder="2022–2024" type="text" />
                </div>
                <div class="form-group">
                  <label class="form-label">Display Type</label>
                  <div style="display:flex; gap:8px; margin-top:2px;">
                    <button class="btn btn-ghost" id="typeBtn_single" onclick="setType('single')" style="flex:1; font-size:12px; padding:6px 10px; justify-content:center;">
                      Single
                    </button>
                    <button class="btn btn-ghost" id="typeBtn_double" onclick="setType('double')" style="flex:1; font-size:12px; padding:6px 10px; justify-content:center;">
                      Double
                    </button>
                  </div>
                </div>
              </div>

              <!-- Tools -->
              <div class="form-group">
                <label class="form-label">Tools <span style="text-transform:none; font-weight:400; color:var(--text-subtle)">— press Enter to add</span></label>
                <div class="tags-input-wrap" id="toolsWrap" onclick="document.getElementById('toolInput').focus()">
                  <div id="toolTagsContainer"></div>
                  <input id="toolInput" placeholder="Figma, C4D..." onkeydown="handleToolInput(event)" />
                </div>
              </div>

              <!-- Designers -->
              <div class="form-group">
                <label class="form-label">Designers</label>
                <div class="designer-selector">
                  <button class="designer-trigger" id="designerTrigger" onclick="toggleDesignerDropdown()">
                    <span id="designerTriggerLabel">Select designers...</span>
                    <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M4 6l4 4 4-4"/></svg>
                  </button>
                  <div class="designer-dropdown" id="designerDropdown">
                    <div id="designerOptions"></div>
                  </div>
                </div>
                <div class="selected-designers" id="selectedDesigners" style="margin-top:8px;"></div>
              </div>

              <!-- Card BG -->
              <div class="form-group">
                <label class="form-label">Card Background</label>
                <div class="color-swatch-row" id="colorSwatches"></div>
              </div>

              <!-- Images -->
              <div class="form-group" id="imagesSection">
                <label class="form-label" id="imagesLabel">Project Image</label>
                <div id="imageSlotsContainer"></div>
              </div>

              <!-- Notes -->
              <div class="form-group">
                <label class="form-label">Notes <span style="text-transform:none; font-weight:400; color:var(--text-subtle)">— optional</span></label>
                <textarea class="form-textarea" id="f_notes" placeholder="Internal notes about this project..."></textarea>
              </div>
            </div>

            <div class="edit-footer">
              <button class="btn btn-ghost" onclick="deleteCurrentWork()">
                <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 4h12M5 4V2h6v2M6 7v5M10 7v5M3 4l1 9h8l1-9"/></svg>
              </button>
              <button class="btn btn-primary" onclick="saveWork()" style="flex:1; justify-content:center;">
                Save Changes
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Delete Confirm -->
  <div class="overlay" id="confirmOverlay">
    <div class="dialog">
      <h3>Delete Work</h3>
      <p>Are you sure you want to delete "<span id="confirmName"></span>"? This can't be undone.</p>
      <div class="dialog-btns">
        <button class="btn btn-ghost" onclick="closeConfirm()">Cancel</button>
        <button class="btn btn-danger" onclick="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast">
    <svg id="toastIcon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"></svg>
    <span id="toastMsg"></span>
  </div>

  <script>
    // ═══════════════════════════════════════════
    // DATA
    // ═══════════════════════════════════════════

    // SUPABASE CONFIG — replace with your values
    // const SUPABASE_URL = 'https://xxxx.supabase.co'
    // const SUPABASE_KEY = 'your-anon-key'
    // import { createClient } from '@supabase/supabase-js'
    // const supabase = createClient(SUPABASE_URL, SUPABASE_KEY)

    const DESIGNERS = [
      { id: 'amir',    name: 'Amirbaqian',       img: null },
      { id: 'mim',     name: 'Mim Sarem',         img: null },
      { id: 'marina',  name: 'Marina Budarina',   img: null },
      { id: 'jahan',   name: 'Jahan',             img: null },
      { id: 'sia7ash', name: 'Sia7ash',           img: null },
      { id: 'rez',     name: 'Rez Musavi',        img: null },
      { id: 'ali',     name: 'Ali Maleki',        img: null },
      { id: 'sarami',  name: 'Mohammad Sarami',   img: null },
      { id: 'behi',    name: 'Reza Behi',         img: null },
      { id: 'boka',    name: 'Ali Boka',          img: null },
    ];

    const BG_SWATCHES = ['#FFFFFF','#F0F0F0','#EFF1F0','#E8ECF4','#F4EDE8','#EAF4EC','#F4EAF2','#111110'];

    // Sample initial data (replace with Supabase fetch)
    let works = [
      {
        id: 1,
        title: 'JET Product Project',
        client: 'FTX Exchange',
        date: '2022–2022',
        tools: ['Figma', 'C4D', 'Maya'],
        designers: ['amir', 'behi', 'rez', 'ali', 'sia7ash'],
        images: [],
        multiple: false,
        bg: '#F0F0F0',
        notes: ''
      },
      {
        id: 2,
        title: 'Perr UI Project',
        client: 'Perr',
        date: '2023–2024',
        tools: ['Figma'],
        designers: ['amir', 'rez', 'ali'],
        images: [],
        multiple: true,
        bg: '#F0F0F0',
        notes: ''
      },
      {
        id: 3,
        title: 'Maham Product Project',
        client: 'Maham',
        date: '2022–2023',
        tools: ['Figma'],
        designers: ['amir', 'jahan', 'rez', 'ali'],
        images: [],
        multiple: false,
        bg: '#EFF1F0',
        notes: ''
      },
    ];

    let selectedWorkId = null;
    let currentWork = null;
    let pendingDeleteId = null;
    let currentTools = [];
    let currentDesigners = [];
    let currentImages = [];
    let currentType = 'single';
    let currentBg = '#F0F0F0';

    // ═══════════════════════════════════════════
    // THEME
    // ═══════════════════════════════════════════
    function toggleTheme() {
      const html = document.documentElement;
      const isDark = html.getAttribute('data-theme') === 'dark';
      html.setAttribute('data-theme', isDark ? 'light' : 'dark');
      document.getElementById('themeLabel').textContent = isDark ? 'Dark Mode' : 'Light Mode';
    }

    // ═══════════════════════════════════════════
    // RENDER
    // ═══════════════════════════════════════════
    function getInitials(name) {
      return name.split(' ').map(w => w[0]).join('').slice(0,2).toUpperCase();
    }

    function renderStats() {
      const total = works.length;
      const singles = works.filter(w => !w.multiple).length;
      const doubles = works.filter(w => w.multiple).length;
      document.getElementById('statsRow').innerHTML = `
        <div class="stat-card">
          <div class="stat-value">${total}</div>
          <div class="stat-label">Total Works</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${singles}</div>
          <div class="stat-label">Single View</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${doubles}</div>
          <div class="stat-label">Double View</div>
        </div>
      `;
    }

    function renderWorks() {
      renderStats();
      document.getElementById('workCount').textContent = works.length + ' items';
      const list = document.getElementById('worksList');
      if (works.length === 0) {
        list.innerHTML = `<div style="text-align:center;padding:40px 20px;color:var(--text-subtle);font-size:13px;">No works yet. Create your first one!</div>`;
        return;
      }
      list.innerHTML = works.map(w => {
        const designers = w.designers.slice(0,3).map(id => {
          const d = DESIGNERS.find(x => x.id === id);
          return d ? `<span style="font-size:10px;font-weight:500;background:var(--surface2);border-radius:50%;width:20px;height:20px;display:inline-flex;align-items:center;justify-content:center;color:var(--text-muted);margin-right:-4px;">${getInitials(d.name)}</span>` : '';
        }).join('');
        const extra = w.designers.length > 3 ? `<span style="font-size:10px;color:var(--text-muted);margin-left:6px;">+${w.designers.length-3}</span>` : '';
        const isSelected = w.id === selectedWorkId;
        return `
          <div class="work-item ${isSelected ? 'selected' : ''}" onclick="selectWork(${w.id})">
            <div class="work-thumb" style="background:${w.bg || 'var(--surface2)'}">
              ${w.images && w.images[0]
                ? `<img src="${w.images[0]}" alt="${w.title}" />`
                : `<svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.2"><rect x="2" y="4" width="16" height="12" rx="2"/><path d="M2 14l4-4 3 3 4-5 5 6"/></svg>`
              }
            </div>
            <div class="work-info">
              <div class="work-name">${w.title}</div>
              <div class="work-meta">
                <span style="color:var(--text-subtle)">${w.client}</span>
                <span style="opacity:0.4">·</span>
                <span style="color:var(--text-subtle)">${w.date}</span>
              </div>
              <div class="work-meta" style="margin-top:4px;">
                ${designers}${extra}
              </div>
            </div>
            <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px;">
              <span class="work-type-badge ${w.multiple ? 'badge-double' : 'badge-single'}">${w.multiple ? 'Double' : 'Single'}</span>
              <div class="work-actions">
                <button class="icon-btn" onclick="event.stopPropagation(); promptDelete(${w.id})" title="Delete" style="width:26px;height:26px;">
                  <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 4h12M5 4V2h6v2M6 7v5M10 7v5M3 4l1 9h8l1-9"/></svg>
                </button>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // ═══════════════════════════════════════════
    // SELECTION & EDIT FORM
    // ═══════════════════════════════════════════
    function selectWork(id) {
      selectedWorkId = id;
      currentWork = works.find(w => w.id === id);
      renderWorks();
      openEditForm(currentWork);
    }

    function openNewWork() {
      selectedWorkId = null;
      currentWork = null;
      renderWorks();
      openEditForm({
        id: null,
        title: '', client: '', date: '',
        tools: [], designers: [], images: [],
        multiple: false, bg: '#F0F0F0', notes: ''
      });
    }

    function openEditForm(work) {
      document.getElementById('previewEmpty').style.display = 'none';
      document.getElementById('editForm').style.display = 'flex';
      document.getElementById('editFormTitle').textContent = work.title || 'New Work';

      // Populate fields
      document.getElementById('f_title').value = work.title || '';
      document.getElementById('f_client').value = work.client || '';
      document.getElementById('f_date').value = work.date || '';
      document.getElementById('f_notes').value = work.notes || '';

      currentType = work.multiple ? 'double' : 'single';
      currentTools = [...(work.tools || [])];
      currentDesigners = [...(work.designers || [])];
      currentImages = [...(work.images || [])];
      currentBg = work.bg || '#F0F0F0';

      renderTypeButtons();
      renderToolTags();
      renderDesignerOptions();
      renderSelectedDesigners();
      renderColorSwatches();
      renderImageSlots();
    }

    function closeEdit() {
      document.getElementById('previewEmpty').style.display = 'flex';
      document.getElementById('editForm').style.display = 'none';
      selectedWorkId = null;
      renderWorks();
    }

    // ═══════════════════════════════════════════
    // TYPE TOGGLE
    // ═══════════════════════════════════════════
    function setType(t) {
      currentType = t;
      renderTypeButtons();
      renderImageSlots();
    }

    function renderTypeButtons() {
      ['single','double'].forEach(t => {
        const btn = document.getElementById(`typeBtn_${t}`);
        if (t === currentType) {
          btn.className = 'btn btn-primary';
        } else {
          btn.className = 'btn btn-ghost';
        }
        btn.style.flex = '1';
        btn.style.fontSize = '12px';
        btn.style.padding = '6px 10px';
        btn.style.justifyContent = 'center';
      });
      const badge = document.getElementById('editTypeBadge');
      badge.textContent = currentType === 'double' ? 'Double' : 'Single';
      badge.className = `work-type-badge ${currentType === 'double' ? 'badge-double' : 'badge-single'}`;
    }

    // ═══════════════════════════════════════════
    // TOOLS TAG INPUT
    // ═══════════════════════════════════════════
    function handleToolInput(e) {
      if (e.key === 'Enter' || e.key === ',') {
        e.preventDefault();
        const val = e.target.value.trim().replace(',','');
        if (val && !currentTools.includes(val)) {
          currentTools.push(val);
          renderToolTags();
        }
        e.target.value = '';
      } else if (e.key === 'Backspace' && e.target.value === '' && currentTools.length) {
        currentTools.pop();
        renderToolTags();
      }
    }

    function removeTool(i) {
      currentTools.splice(i, 1);
      renderToolTags();
    }

    function renderToolTags() {
      document.getElementById('toolTagsContainer').innerHTML = currentTools.map((t,i) =>
        `<span class="tool-tag">${t}<button onclick="removeTool(${i})"><svg viewBox="0 0 10 10" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M2 2l6 6M8 2L2 8"/></svg></button></span>`
      ).join('');
    }

    // ═══════════════════════════════════════════
    // DESIGNERS
    // ═══════════════════════════════════════════
    function toggleDesignerDropdown() {
      const trigger = document.getElementById('designerTrigger');
      const dropdown = document.getElementById('designerDropdown');
      const isOpen = dropdown.classList.contains('open');
      dropdown.classList.toggle('open', !isOpen);
      trigger.classList.toggle('open', !isOpen);

      if (!isOpen) {
        document.addEventListener('click', closeDropdownOutside, { once: true });
      }
    }

    function closeDropdownOutside(e) {
      const selector = document.querySelector('.designer-selector');
      if (!selector.contains(e.target)) {
        document.getElementById('designerDropdown').classList.remove('open');
        document.getElementById('designerTrigger').classList.remove('open');
      }
    }

    function toggleDesigner(id) {
      const idx = currentDesigners.indexOf(id);
      if (idx === -1) currentDesigners.push(id);
      else currentDesigners.splice(idx, 1);
      renderDesignerOptions();
      renderSelectedDesigners();
    }

    function removeDesigner(id) {
      currentDesigners = currentDesigners.filter(d => d !== id);
      renderDesignerOptions();
      renderSelectedDesigners();
    }

    function renderDesignerOptions() {
      document.getElementById('designerOptions').innerHTML = DESIGNERS.map(d => {
        const sel = currentDesigners.includes(d.id);
        return `
          <div class="designer-option ${sel ? 'selected' : ''}" onclick="toggleDesigner('${d.id}')">
            <div class="designer-avatar">${getInitials(d.name)}</div>
            <span class="designer-name">${d.name}</span>
            <div class="check-icon">
              <svg viewBox="0 0 10 8"><path d="M1 4l3 3 5-6" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </div>
          </div>
        `;
      }).join('');
      document.getElementById('designerTriggerLabel').textContent =
        currentDesigners.length ? `${currentDesigners.length} selected` : 'Select designers...';
    }

    function renderSelectedDesigners() {
      const container = document.getElementById('selectedDesigners');
      if (currentDesigners.length === 0) { container.innerHTML = ''; return; }
      container.innerHTML = currentDesigners.map(id => {
        const d = DESIGNERS.find(x => x.id === id);
        if (!d) return '';
        return `
          <div class="designer-tag">
            <div class="tag-avatar"><span style="font-size:9px;font-weight:600;display:flex;align-items:center;justify-content:center;width:100%;height:100%;">${getInitials(d.name)}</span></div>
            ${d.name}
            <button onclick="removeDesigner('${id}')">
              <svg viewBox="0 0 10 10" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M2 2l6 6M8 2L2 8"/></svg>
            </button>
          </div>
        `;
      }).join('');
    }

    // ═══════════════════════════════════════════
    // COLORS
    // ═══════════════════════════════════════════
    function selectBg(color) {
      currentBg = color;
      renderColorSwatches();
    }

    function renderColorSwatches() {
      document.getElementById('colorSwatches').innerHTML = BG_SWATCHES.map(c =>
        `<div class="color-swatch ${c === currentBg ? 'selected' : ''}" style="background:${c};border:1.5px solid ${c === '#FFFFFF' || c === '#F0F0F0' || c === '#EFF1F0' ? 'var(--border)' : 'transparent'}" onclick="selectBg('${c}')" title="${c}"></div>`
      ).join('') + `
        <div class="color-swatch-custom" title="Custom color" onclick="document.getElementById('customColor').click()">
          <input type="color" id="customColor" onchange="selectBg(this.value)" />
          <svg viewBox="0 0 10 10" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px"><path d="M5 2v6M2 5h6"/></svg>
        </div>
      `;
    }

    // ═══════════════════════════════════════════
    // IMAGES — slot-based (1 slot for single, 2 for double)
    // ═══════════════════════════════════════════

    // currentImages is always an array:
    //   single → [img0]  (index 0)
    //   double → [img0, img1]  (index 0 = left, index 1 = right)

    function uploadIconSVG() {
      return `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>`;
    }

    function renderImageSlots() {
      const container = document.getElementById('imageSlotsContainer');
      const label = document.getElementById('imagesLabel');
      const isDouble = currentType === 'double';

      label.textContent = isDouble ? 'Project Images — Left & Right' : 'Project Image';

      const slotCount = isDouble ? 2 : 1;
      const slotLabels = isDouble ? ['Left Card', 'Right Card'] : [''];

      // ensure array is right size
      while (currentImages.length < slotCount) currentImages.push(null);
      if (!isDouble) currentImages = currentImages.slice(0, 1);

      let html = isDouble
        ? `<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">`
        : `<div>`;

      for (let i = 0; i < slotCount; i++) {
        const src = currentImages[i];
        html += `<div>`;
        if (isDouble) {
          html += `<div style="font-size:11px;font-weight:500;color:var(--text-subtle);margin-bottom:5px;letter-spacing:0.04em;text-transform:uppercase;">${slotLabels[i]}</div>`;
        }

        if (src) {
          // show preview with remove button
          html += `
            <div class="image-slot-preview" style="position:relative;aspect-ratio:4/3;border-radius:${isDouble ? '10px' : '12px'};overflow:hidden;border:1px solid var(--border);">
              <img src="${src}" style="width:100%;height:100%;object-fit:cover;" />
              <button onclick="removeSlotImage(${i})" style="position:absolute;top:6px;right:6px;width:24px;height:24px;background:rgba(0,0,0,0.55);border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#fff;transition:background 0.12s;" onmouseover="this.style.background='rgba(0,0,0,0.75)'" onmouseout="this.style.background='rgba(0,0,0,0.55)'">
                <svg viewBox="0 0 10 10" fill="none" stroke="currentColor" stroke-width="1.8" style="width:10px;height:10px;"><path d="M2 2l6 6M8 2L2 8"/></svg>
              </button>
            </div>
          `;
        } else {
          // show upload area
          html += `
            <div class="image-upload-area" onclick="document.getElementById('imgSlot_${i}').click()" style="${isDouble ? 'padding:16px 10px;' : ''}">
              ${uploadIconSVG()}
              <p>${isDouble ? 'Upload image' : 'Click to upload image'}</p>
              <span>PNG, JPG, WebP</span>
            </div>
            <input type="file" id="imgSlot_${i}" accept="image/*" style="display:none" onchange="handleSlotUpload(event, ${i})" />
          `;
        }
        html += `</div>`;
      }

      html += `</div>`;
      container.innerHTML = html;
    }

    function handleSlotUpload(e, slotIndex) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        currentImages[slotIndex] = ev.target.result;
        renderImageSlots();
      };
      reader.readAsDataURL(file);
      e.target.value = '';
    }

    function removeSlotImage(slotIndex) {
      currentImages[slotIndex] = null;
      renderImageSlots();
    }

    // ═══════════════════════════════════════════
    // SAVE
    // ═══════════════════════════════════════════
    function saveWork() {
      const title = document.getElementById('f_title').value.trim();
      if (!title) { showToast('Title is required', 'error'); return; }

      const workData = {
        title,
        client: document.getElementById('f_client').value.trim(),
        date: document.getElementById('f_date').value.trim(),
        tools: [...currentTools],
        designers: [...currentDesigners],
        images: currentImages.filter(Boolean),
        multiple: currentType === 'double',
        bg: currentBg,
        notes: document.getElementById('f_notes').value.trim(),
      };

      if (selectedWorkId) {
        const idx = works.findIndex(w => w.id === selectedWorkId);
        works[idx] = { ...works[idx], ...workData };
        // SUPABASE: await supabase.from('works').update(workData).eq('id', selectedWorkId)
      } else {
        workData.id = Date.now();
        works.push(workData);
        selectedWorkId = workData.id;
        // SUPABASE: const { data } = await supabase.from('works').insert(workData).select().single()
      }

      document.getElementById('editFormTitle').textContent = title;
      renderWorks();
      showToast('Saved successfully', 'success');
    }

    // ═══════════════════════════════════════════
    // DELETE
    // ═══════════════════════════════════════════
    function promptDelete(id) {
      pendingDeleteId = id;
      const w = works.find(x => x.id === id);
      document.getElementById('confirmName').textContent = w ? w.title : '';
      document.getElementById('confirmOverlay').classList.add('open');
    }

    function deleteCurrentWork() {
      if (!selectedWorkId) return;
      promptDelete(selectedWorkId);
    }

    function closeConfirm() {
      document.getElementById('confirmOverlay').classList.remove('open');
      pendingDeleteId = null;
    }

    function confirmDelete() {
      if (!pendingDeleteId) return;
      works = works.filter(w => w.id !== pendingDeleteId);
      // SUPABASE: await supabase.from('works').delete().eq('id', pendingDeleteId)
      if (selectedWorkId === pendingDeleteId) closeEdit();
      closeConfirm();
      renderWorks();
      showToast('Work deleted', 'success');
    }

    // ═══════════════════════════════════════════
    // TOAST
    // ═══════════════════════════════════════════
    let toastTimer;
    function showToast(msg, type = 'success') {
      clearTimeout(toastTimer);
      const toast = document.getElementById('toast');
      const icon = document.getElementById('toastIcon');
      document.getElementById('toastMsg').textContent = msg;
      toast.className = `toast ${type}`;

      if (type === 'success') {
        icon.innerHTML = '<path d="M2 8l4 4 8-8" stroke="currentColor" stroke-width="1.8" fill="none" stroke-linecap="round" stroke-linejoin="round"/>';
      } else {
        icon.innerHTML = '<path d="M8 4v4M8 11v1" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/><circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5" fill="none"/>';
      }

      requestAnimationFrame(() => toast.classList.add('show'));
      toastTimer = setTimeout(() => toast.classList.remove('show'), 2800);
    }

    function setPage(page) {
      showToast(`Switched to ${page}`, 'success');
    }

    // ═══════════════════════════════════════════
    // INIT
    // ═══════════════════════════════════════════
    // ─── آپلود عکس به Supabase (با Progress Bar) ───
async function uploadImageIfNeeded(src) {
  if (!src || src.startsWith('http')) return src;

  // Fetch the image and create a File
  const res = await fetch(src);
  const blob = await res.blob();
  const ext = (blob.type || 'image/jpeg').split('/')[1] || 'jpg';
  const filename = `img-${Date.now()}.${ext}`;
  const file = new File([blob], filename, { type: blob.type });

  // Step 1: Request a presigned upload URL from the server
  const urlReq = await fetch('/api/works/create-upload-url', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ filename }),
  });

  if (!urlReq.ok) {
    const err = await urlReq.json();
    showToast(`Upload URL error: ${err.error || 'Unknown error'}`, 'error');
    throw new Error(err.error || 'Failed to create upload URL');
  }

  const { uploadUrl, publicUrl } = await urlReq.json();

  // Step 2: PUT the file directly to Supabase using the signed URL with progress tracking
  return new Promise((resolve, reject) => {
    const xhr = new XMLHttpRequest();

    // Track upload progress
    xhr.upload.addEventListener('progress', (event) => {
      if (event.lengthComputable) {
        const percentComplete = Math.round((event.loaded / event.total) * 100);
        showToast(`Uploading... ${percentComplete}%`, 'success');
      }
    });

    xhr.addEventListener('load', () => {
      if (xhr.status === 200 || xhr.status === 204) {
        showToast(`Upload complete!`, 'success');
        resolve(publicUrl);
      } else {
        const error = `Upload failed with status ${xhr.status}`;
        showToast(error, 'error');
        reject(new Error(error));
      }
    });

    xhr.addEventListener('error', () => {
      const error = 'Upload failed (network error)';
      showToast(error, 'error');
      reject(new Error(error));
    });

    xhr.addEventListener('abort', () => {
      const error = 'Upload cancelled';
      showToast(error, 'error');
      reject(new Error(error));
    });

    // Set the Content-Type to match the file
    xhr.open('PUT', uploadUrl, true);
    xhr.setRequestHeader('Content-Type', file.type || 'application/octet-stream');

    xhr.send(file);
  });
}

// ─── ذخیره کار ───────────────────────────────────
async function saveWork() {
  const title = document.getElementById('f_title').value.trim();
  if (!title) { showToast('Title is required', 'error'); return; }
  showToast('در حال ذخیره...', 'success');
  const uploaded = await Promise.all(
    currentImages.filter(Boolean).map(uploadImageIfNeeded)
  );
  const body = {
    id: selectedWorkId || undefined,
    title,
    client:    document.getElementById('f_client').value.trim(),
    date:      document.getElementById('f_date').value.trim(),
    tools:     [...currentTools],
    designers: [...currentDesigners],
    images:    uploaded,
    multiple:  currentType === 'double',
    bg:        currentBg,
    notes:     document.getElementById('f_notes').value.trim(),
  };
  const method = selectedWorkId ? 'PUT' : 'POST';
  const res = await fetch('/api/works', {
    method, headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(body),
  });
  if (!res.ok) { showToast('خطا در ذخیره', 'error'); return; }
  const saved = await res.json();
  if (!selectedWorkId) { works.push(saved); selectedWorkId = saved.id; }
  else { const i = works.findIndex(w => w.id === selectedWorkId); works[i] = saved; }
  document.getElementById('editFormTitle').textContent = title;
  renderWorks();
  showToast('ذخیره شد ✓', 'success');
}

// ─── حذف کار ─────────────────────────────────────
async function confirmDelete() {
  if (!pendingDeleteId) return;
  const res = await fetch(`/api/works?id=${pendingDeleteId}`, { method: 'DELETE' });
  if (!res.ok) { showToast('خطا در حذف', 'error'); return; }
  works = works.filter(w => w.id !== pendingDeleteId);
  if (selectedWorkId === pendingDeleteId) closeEdit();
  closeConfirm();
  renderWorks();
  showToast('حذف شد', 'success');
}

// ─── بارگذاری اولیه از Supabase ──────────────────
async function initDashboard() {
  const res  = await fetch('/api/works');
  const data = await res.json();
  works = data || [];
  renderWorks();
}

initDashboard();

  </script>
</body>
</html>
